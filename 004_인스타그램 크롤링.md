# 004_제주도 핫플래이스
---
## 목차
- 1.인스타 크롤링
- 2.헤시테그 시각화
---
## 1.인스타 크롤링
### 1)크롤링 시작


```python
import pandas as pd
import numpy as np
import time
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from bs4 import BeautifulSoup
ser=Service('../chromedriver/chromedriver.exe')
driver=webdriver.Chrome(service=ser)
```


```python
url='https://www.instagram.com/'
driver.get(url)
time.sleep(3)
html=driver.page_source
soup=BeautifulSoup(html,'html.parser')
```

### 2)인스타 접속 후 로그인

- 로그인 하기 -> 직접하자 보안이슈
- -> 제주도맛집 검색 
[https://www.instagram.com/explore/tags/+()]()만 변하는 군


```python
email = '인스타계정입력해주세요'   ### 계정 정보 수정 필요
input_id = driver.find_elements_by_css_selector('input._2hvTZ.pexuQ.zyHYP')[0]
input_id.clear()
input_id.send_keys(email)

password = '인스타비번입력해주세요' ### 비번 정보 수정 필요
input_pw = driver.find_elements_by_css_selector('input._2hvTZ.pexuQ.zyHYP')[1]
input_pw.clear()
input_pw.send_keys(password)
input_pw.submit()
time.sleep(3)
```

### 3)인스타 검색 결과 url만들어 접속


```python
def insta_searching(word):
    url='https://www.instagram.com/explore/tags/'+word
    return(url)
```


```python
word='제주도맛집'
driver.get(insta_searching(word))
time.sleep(5) #오류방지용
```

### 4)첫 개시글 열기


```python
from selenium.webdriver.common.by import By
#first=driver.find_element_by_css_selector('div._9AhH0')
def select_first(driver):
    first=driver.find_element(By.CSS_SELECTOR, 'div._9AhH0')
    first.click()
    time.sleep(5)
select_first(driver)
```

### 5)게시글 정보 가져오기
#### (1)본문 긁기


```python
html=driver.page_source
soup=BeautifulSoup(html, 'html.parser')
import unicodedata #멕용 한글때문
content=soup.select('div.C4VMK > span')[0].text
content=unicodedata.normalize('NFC', content) #멕용 한글때문
content
```




    '제주 산방산 가기전 먹방투어출출할 때 유명한 #천지연숯화로구이 에서!!흑돼지오겹살 + 소고기꽃갈비진짜 잘나옴!맛도 좋고 사장님도 친절해서한번만 갔다온 사람은 없는 그 곳!천지연숯화로구이064-794-6243#천지연숯화로구이#산방산맛집#송악산맛집#산방산흑돼지맛집#제주흑돼지맛집#제주용머리해안맛집#안덕맛집#오설록맛집#산방산흑돼지#오설록흑돼지맛집#모슬포맛집#서귀포흑돼지#신화월드맛집#중문관광단지흑돼지#제주도맛집#제주가볼만한곳'



#### (2)헤시테그 긁기 


```python
import re

tags = re.findall(r'#[^\s#,\\]+',content)
# tags = re.findall(r'#\w+',content)
tags
```




    ['#천지연숯화로구이',
     '#천지연숯화로구이',
     '#산방산맛집',
     '#송악산맛집',
     '#산방산흑돼지맛집',
     '#제주흑돼지맛집',
     '#제주용머리해안맛집',
     '#안덕맛집',
     '#오설록맛집',
     '#산방산흑돼지',
     '#오설록흑돼지맛집',
     '#모슬포맛집',
     '#서귀포흑돼지',
     '#신화월드맛집',
     '#중문관광단지흑돼지',
     '#제주도맛집',
     '#제주가볼만한곳']



#### (3)작성일자 긁기 


```python
date = soup.select('time._1o9PC.Nzb55')[0]['datetime'][:10]
date
```




    '2022-01-17'



#### (4)좋아요 수 긁기 


```python
like = soup.select('div.Nm9Fw > a > span')[0].text#여러개 하면 문제발생
like = soup.select('a.zV_Nj > span')[0].text
like
```




    '1,600'



#### (5)위치정보 긁기 


```python
place = soup.select('a.O4GlU')
place = unicodedata.normalize('NFC', place)
place
```

#### (6)함수화 하기


```python
def get_content(driver):
    html = driver.page_source
    soup = BeautifulSoup(html, 'html.parser')
    
    try:
        content = soup.select('div.C4VMK > span')[0].text
        content = unicodedata.normalize('NFC', content)
    except:
        content = ""
    
    
    try:
        tags = re.findall(r'#[^\s#,\\]+',content)
    except:
        tags = ""
        
    date = soup.select('time._1o9PC.Nzb55')[0]['datetime'][:10]
    
    try:
        like = soup.select('a.zV_Nj > span')[0].text
    except:
        like = 0
    
    try:
        place = soup.select('a.O4GlU')
        place = unicodedata.normalize('NFC', place)
    except:
        place = ""    
    data = [content, date, like, place, tags]    
    return(data)
          
```


```python
mylist = get_content(driver)
mylist
```




    ['제주 산방산 가기전 먹방투어출출할 때 유명한 #천지연숯화로구이 에서!!흑돼지오겹살 + 소고기꽃갈비진짜 잘나옴!맛도 좋고 사장님도 친절해서한번만 갔다온 사람은 없는 그 곳!천지연숯화로구이064-794-6243#천지연숯화로구이#산방산맛집#송악산맛집#산방산흑돼지맛집#제주흑돼지맛집#제주용머리해안맛집#안덕맛집#오설록맛집#산방산흑돼지#오설록흑돼지맛집#모슬포맛집#서귀포흑돼지#신화월드맛집#중문관광단지흑돼지#제주도맛집#제주가볼만한곳',
     '2022-01-17',
     '1,600',
     '',
     ['#천지연숯화로구이',
      '#천지연숯화로구이',
      '#산방산맛집',
      '#송악산맛집',
      '#산방산흑돼지맛집',
      '#제주흑돼지맛집',
      '#제주용머리해안맛집',
      '#안덕맛집',
      '#오설록맛집',
      '#산방산흑돼지',
      '#오설록흑돼지맛집',
      '#모슬포맛집',
      '#서귀포흑돼지',
      '#신화월드맛집',
      '#중문관광단지흑돼지',
      '#제주도맛집',
      '#제주가볼만한곳']]



### 6)다음페이지로 이동


```python
def move_next(driver):
    
    right = driver.find_element(By.CSS_SELECTOR, 'div.l8mY4.feth3')
    right.click()
    time.sleep(3)
    
move_next(driver)
```

### 7)자동으로 크롱링 하기(함수화)


```python
def insta_crawling(word, n):
    url = insta_searching(word)
    
    driver.get(url)
    time.sleep(5)
    
    select_first(driver)
    time.sleep(5)
    
    
#     target = n
    results = []
    
    for i in range(n):
        try:
            data = get_content(driver)
            results.append(data)
            move_next(driver)
            
        except:
            time.sleep(2)
            move_next(driver)
            
    return(results)
```


```python
result_1 = insta_crawling('제주도맛집', 20)
len(result_1)
result_1[0]
```




    ['많은 연예인들도 왔다 갈 정도로 유명해서 먹어보았어요생물갈치만 쓴다고 하는데 사이즈가 정말 상상이상이라 강추!#서귀포맛집 #제주중문맛집 #색달식당중문본점.....#제주도맛집#제주갈치조림#중문갈치조림#중문관광단지맛집#제주도중문맛집#중문맛집색달식당#제주갈치구이#제주갈치조림맛집',
     '2022-01-16',
     '158',
     '',
     ['#서귀포맛집',
      '#제주중문맛집',
      '#색달식당중문본점.....',
      '#제주도맛집',
      '#제주갈치조림',
      '#중문갈치조림',
      '#중문관광단지맛집',
      '#제주도중문맛집',
      '#중문맛집색달식당',
      '#제주갈치구이',
      '#제주갈치조림맛집']]



### 8) 수집데이터 저장


```python
result_df = pd.DataFrame(result_1)
result_df.columns = ['content','date','like','place','tags']
result_df.to_excel('./files/1_crawling_jejuMatJip.xlsx', index=False)
result_df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>content</th>
      <th>date</th>
      <th>like</th>
      <th>place</th>
      <th>tags</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>많은 연예인들도 왔다 갈 정도로 유명해서 먹어보았어요생물갈치만 쓴다고 하는데 사이즈...</td>
      <td>2022-01-16</td>
      <td>158</td>
      <td></td>
      <td>[#서귀포맛집, #제주중문맛집, #색달식당중문본점....., #제주도맛집, #제주갈...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>가성비갑👍제주통갈치구이, 전복구이, 갈치조림, 보말국 등 제주대표 음식들을 가장 가...</td>
      <td>2022-01-17</td>
      <td>0</td>
      <td></td>
      <td>[#제주시맛집, #동문시장맛집, #제주공항근처맛집, #용두암맛집, #탑동맛집, #제...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>&lt;광고&gt;온가족이 즐길 수 있는 제주갈비국수!!💕✔손소독제 항시 배치(입장시 입구부터...</td>
      <td>2022-01-16</td>
      <td>0</td>
      <td></td>
      <td>[#제주맛집, #제주도맛집, #제주아쿠아플라넷, #표선맛집, #성산맛집, #성산일출...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>...제주 데이트코스추천!@@여자친구,남자친구와 함께하면 좋은 제주공항근처 완벽코스...</td>
      <td>2022-01-17</td>
      <td>161</td>
      <td></td>
      <td>[#충민정-제주가면, #도두봉키세스존-도두봉, #우무-제주공항근처, #우마담풍하-한...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>제주 산방산 가기전 먹방투어출출할 때 유명한 #천지연숯화로구이 에서!!흑돼지오겹살 ...</td>
      <td>2022-01-17</td>
      <td>1,601</td>
      <td></td>
      <td>[#천지연숯화로구이, #천지연숯화로구이, #산방산맛집, #송악산맛집, #산방산흑돼지...</td>
    </tr>
  </tbody>
</table>
</div>



### 9)여러 엑셀의 중복을 제거한후 통합
#### (1)통합


```python
jeju_insta_df = pd.DataFrame()

f_list = ['1_crawling_jejudoMatJip.xlsx', '1_crawling_jejudoGwanGwang.xlsx', 
          '1_crawling_jejuMatJip.xlsx', '1_crawling_jejuYeoHang.xlsx']

for fname in f_list:
    fpath = './files/' + fname
    temp = pd.read_excel(fpath)
    jeju_insta_df = jeju_insta_df.append(temp)
```

#### (2)제거


```python
jeju_insta_df.shape
```




    (12780, 5)




```python
jeju_insta_df.drop_duplicates(subset = ['content'], inplace = True)
jeju_insta_df.shape
```




    (8369, 5)



## 2.헤시테그 시각화
### 1)헤시테그 데이터 불러오기


```python
jeju_insta_df.to_excel('./files/1_crawling_raw.xlsx', index = False)
raw_total = jeju_insta_df.copy()
```


```python
raw_total.columns
raw_total['tags']
```




    0       ['#제주분식', '#제주맛집', '#제주도맛집', '#제주맛집추천', '#제주도맛...
    1       ['#함덕맛집', '#제주도카페투어', '#제주일상', '#함덕', '#jejudo...
    2       ['#동문시장', '#제주동문시장', '#제주도기념품', '#제주기념품', '#제주...
    3       ['#제주여행', '#2일차무거버거', '#제주도여행', '#제주맛집', '#함덕맛...
    4                                                      []
                                  ...                        
    1702    ['#일상', '#구기자', '#티타임', '#2019', '#새해', '#차스타그...
    1703    ['#제주', '#친정여행', '#겨울방학', '#제주여행앞머리는', '#친정찬스'...
    1705                           ['#사진좀찍으시는님덕에건져또', '#이순간']
    1706                                                   []
    1707                            ['#HappyNewYearEveryone']
    Name: tags, Length: 8369, dtype: object




```python
tags_total = []

for tags in raw_total['tags']:
    tags_list = tags[2:-2].split("', '")
    for tag in tags_list:
        tags_total.append(tag)

raw_total['tags'][1].str[2:-2]
```




    1    #함덕맛집', '#제주도카페투어', '#제주일상', '#함덕', '#jejudo',...
    1    #제주핫플', '#제주여행', '#제주', '#제주도', '#제주도맛집', '#제주...
    1    #함스타푸드_속초청초수물회✔️속초핫플레이스해삼전복물회✔️40.000₩.대한민국', ...
    1    #동백군락지', '#제주위미동백군락지', '#제주', '#위미', '#동백', '#...
    Name: tags, dtype: object



### 2)해시태그 출현 빈도 집계
#### (1)빈도수 집계


```python
from collections import Counter

tag_counts = Counter(tags_total)
tag_counts
# pd.Series(tags_total).value_counts()
```




    Counter({'#제주분식': 76,
             '#제주맛집': 3412,
             '#제주도맛집': 3149,
             '#제주맛집추천': 675,
             '#제주도맛집추천': 187,
             '#제주도': 2053,
             '#용두암': 18,
             '#제주해안도로': 311,
             '#월정리카페거리': 6,
             '#제주피크닉': 6,
             '#모의면접': 12,
             '#예승원': 12,
             '#예승이': 12,
             '#형준샘': 12,
             '#항공과스터디': 12,
             '#항공과면접': 12,
             '#인도음식점': 1,
             ...})



#### (2)쩌리 제거


```python
tag_counts.most_common(50)
```




    [('#제주맛집', 3412),
     ('#제주도맛집', 3149),
     ('#제주여행', 3020),
     ('#제주관광', 2827),
     ('#제주도', 2053),
     ('#제주', 1538),
     ('#제주도여행', 1454),
     ('#서귀포맛집', 1330),
     ('#제주도가볼만한곳', 1014),
     ('#제주핫플레이스', 835),
     ('#서귀포', 825),
     ('#jeju', 749),
     ('#일상', 701),
     ('#제주흑돼지맛집', 685),
     ('#제주맛집추천', 675),
     ('#제주도흑돼지맛집', 669),
     ('#제주도흑돼지', 663),
     ('#성산일출봉', 650),
     ('#제주흑돼지', 648),
     ('#협재맛집', 602),
     ('#제주카페', 600),
     ('#제주도그램', 594),
     ('#서귀포흑돼지맛집', 593),
     ('', 587),
     ('#서귀포흑돼지', 577),
     ('#제주도민', 570),
     ('#섭지코지', 556),
     ('#성산일출봉맛집', 545),
     ('#섭지코지맛집', 511),
     ('#선팔', 503),
     ('#제주가볼만한곳', 497),
     ('#통갈치구이', 494),
     ('#제주통갈치구이', 485),
     ('#제주핫플', 483),
     ('#제주살이', 480),
     ('#제주서귀포맛집', 479),
     ('#제주도민맛집', 477),
     ('#여행스타그램', 472),
     ('#제주반영구', 440),
     ('#제주도관광', 440),
     ('#여행', 436),
     ('#제주눈썹문신', 434),
     ('#서귀포눈썹문신', 420),
     ('#제주시', 419),
     ('#제주스타그램', 408),
     ('#눈썹문신', 405),
     ('#반영구', 405),
     ('#중문맛집', 404),
     ('#제주일상', 398),
     ('#제주속눈썹', 397)]



#### (3)쓸모없는 헤시테그 제거


```python
STOPWORDS = ['#일상', '#선팔', '#제주도', '#jeju', '#반영구', '#제주자연눈썹',
'#서귀포눈썹문신', '#제주눈썹문신', '#소통', '#맞팔', '#제주속눈썹',
            '#제주일상', '#여행스타그램', '#눈썹문신', '#카멜리아힐',
            '#daily', '#제주반영구', '#여행']

tag_total_selected = []

for tag in tags_total:
    if not tag in STOPWORDS:
        tag_total_selected.append(tag)
        
tag_total_selected = Counter(tag_total_selected)
tag_total_selected.most_common(50)
```




    [('#제주맛집', 3412),
     ('#제주도맛집', 3149),
     ('#제주여행', 3020),
     ('#제주관광', 2827),
     ('#제주', 1538),
     ('#제주도여행', 1454),
     ('#서귀포맛집', 1330),
     ('#제주도가볼만한곳', 1014),
     ('#제주핫플레이스', 835),
     ('#서귀포', 825),
     ('#제주흑돼지맛집', 685),
     ('#제주맛집추천', 675),
     ('#제주도흑돼지맛집', 669),
     ('#제주도흑돼지', 663),
     ('#성산일출봉', 650),
     ('#제주흑돼지', 648),
     ('#협재맛집', 602),
     ('#제주카페', 600),
     ('#제주도그램', 594),
     ('#서귀포흑돼지맛집', 593),
     ('', 587),
     ('#서귀포흑돼지', 577),
     ('#제주도민', 570),
     ('#섭지코지', 556),
     ('#성산일출봉맛집', 545),
     ('#섭지코지맛집', 511),
     ('#제주가볼만한곳', 497),
     ('#통갈치구이', 494),
     ('#제주통갈치구이', 485),
     ('#제주핫플', 483),
     ('#제주살이', 480),
     ('#제주서귀포맛집', 479),
     ('#제주도민맛집', 477),
     ('#제주도관광', 440),
     ('#제주시', 419),
     ('#제주스타그램', 408),
     ('#중문맛집', 404),
     ('#먹스타그램', 395),
     ('#서귀포반영구', 395),
     ('#서귀포속눈썹', 395),
     ('#제주남자눈썹문신', 395),
     ('#서귀포자연눈썹', 395),
     ('#서귀포남자눈썹문신', 395),
     ('#중문흑돼지맛집', 377),
     ('#애월맛집', 373),
     ('#제주메이크업', 358),
     ('#가족여행', 356),
     ('#제주도여행코스', 350),
     ('#jejuisland', 343),
     ('#성산맛집', 316)]



### 4)막대차트로 살펴보기


```python
import matplotlib.pyplot as plt
from matplotlib import rc
import sys
import seaborn as sns

rc('font', family = "malgun gothic")
```


```python
tag_count_df = pd.DataFrame(tag_total_selected.most_common(50))
tag_count_df.columns =['tags', 'counts']
tag_count_df.head()

##  blank 지우기
tag_count_df['tags'].replace('', None, inplace = True)
tag_count_df['tags']
tag_count_df.dropna(subset = ['tags'], inplace = True)

plt.figure(figsize = (10, 8))
sns.barplot(x = 'counts', y = 'tags',
           data = tag_count_df)
plt.show()
```


    
![png](output_48_0.png)
    



```python

```
